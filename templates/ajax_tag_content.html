{% extends "base_table.html" %}
{% load filters smartif%}

{# NOTE: This the template page for the Resource Results lightbox/popup #}

{% block main_table_content %}
    
    {% if is_ajax %}
        
        <div id="printContainer_outter">
            <div id="printContainer_inner">
                <span>&nbsp;</span>
                <ul id="printSelect_options" class="customSelectList">
                    <li data-value="def"><span>To print, choose one&nbsp;...&nbsp;</span></li>
                    <li data-value="cur" ><span>Print Current Tab</span></li>
                    <li data-value="all"><span>Print All Tabs</span></li>
                </ul>
            </div>
            <span id="printSelect" class="customSelectContainer" tabindex="0">
                <span id="resource-print-icon"></span><span class="selected"></span>
                <span class="dropIcon" style="float:right;"></span>
            </span>
        </div>
        
        <h1><span id="tag-name">"{{ tag.name }}"</span> has <span id="num-related-items" class="{ number: {{ num_related_items }} }"><img src="{{ MEDIA_URL }}images/resource_popup_xplore_loader.gif" /></span> related resources</h1>
        <div class="resources-pad">
        
            
            <div class="alt-box">
                <div id="content" class="alt-box-pad">
    {% else %}
        
    {% endif %}

                    <div id="resource-tabs" class="nootabs tag-resources-tabs { useCookies:false, defaultTab:2, useHash:false }">
                        <ul class="nootabs-menus">
                            <li id="industry-sectors-tab" class="begin-group-menu"><a href="" class="two-word-menu">Industry <br />Sectors <span>({{ parent_nodes|length }})</span></a></li>
                            {% comment %}
                            #TODO: Re-enable clusters
                            #<li><a href="">Sectors &amp; Clusters ({{ parent_nodes|length }})</a></li>
                            {% endcomment %}
                            {% comment %}
                            #<li><a href="">Filters ({{ tag.filters.count }})</a></li>
                            {% endcomment %}
                            <li id="ieee-societies-tab" class="middle-group-menu"><a href="" class="two-word-menu">IEEE<br /> Organizations <span>({{ tag.societies.count }})</span></a></li>
                            <li id="related-tags-tab" class="end-group-menu last-menu"><a href="" class="two-word-menu">Related <br />Tags <span>({{ tag.related_tags.count }})</span></a></li>
                            <li id="conferences-tab" class="begin-group-menu"><a href="" class="one-word-menu">Conferences <span>({{conferences|length}})</span></a></li>
                            <li id="periodicals-tab" class="middle-group-menu"><a href="" class="one-word-menu">Periodicals <span>({{periodicals|length}})</span></a></li>
                            <li id="standards-tab" class="end-group-menu last-menu"><a href="" class="one-word-menu">Standards <span>({{standards|length}})</span></a></li>
                            {% comment %}
                            #    <li><a href="">Experts <span>({{experts|length}})</span></a></li>
                            {% endcomment %}
                            <li id="articles-tab" class="right-menu"><a href="" class="two-word-menu">IEEE Xplore<br/>Articles <span id="num-xplore-results"></span></a></li>
                        </ul>
                        
                        <!-- Sectors &amp; Clusters -->
                        <div id="sector-tab" class="sector-tab" data-printUrl='{% url print_resource tag.id "sectors" %}'>
                            <div class="group">
                                {% if parent_nodes|length %}
                                    {% for parent_node in parent_nodes %}
                                        <p class="{% cycle 'item_odd' 'item_even' %}">
                                            {% ifequal ui "textui" %}
                                                <a href="javascript:Tags.selectSector({{ parent_node.sector.id }});">
                                                    <span>{{ parent_node.sector.name }}</span>
                                                </a>
                                            {% else %}
                                                {% ifequal ui "roamer" %}
                                                    <a href="javascript:Roamer.setNode({{ parent_node.sector.id }});">
                                                        <span>{{ parent_node.sector.name }}</span>
                                                    </a>
                                                {% endifequal %}
                                            {% endifequal %}
                                            {% if parent_node.clusters %}
                                                - {{ parent_node.clusters|textlist }} cluster{{ parent_node.clusters|pluralize }}
                                            {% endif %}
                                        </p>
                                    {% endfor %}
                                {% else %}
                                    <p class="no-resources">No sectors are currently tagged "{{ tag.name }}"</p>
                                {% endif %}
                            </div>
                        </div>
                        
                        {% comment %}
                        <!-- Filters -->
                        <div>
                            <div class="group">
                                {% for filter in tag.filters.all %}
                                    <p class="{% cycle 'item_odd' 'item_even' %}">
                                        {{ filter.name }}
                                    </p>
                                {% endfor %}
                            </div>
                        </div>
                        {% endcomment %}
                        
                        <!-- Organizations -->
                        <div id="society-tab" data-printUrl='{% url print_resource tag.id "societies" %}'>
                            <div class="group">
                            {% if tag.node_societies.all %}
                                <table class="society-images">
                                    {% for node_society in tag.node_societies.all %}
                                        <tr>
                                            <td class="society-logo">
                                                {% if node_society.society.logo_thumbnail %}
                                                    <div class="image-container">
                                                        <img src="{{ node_society.society.logo_thumbnail.url }}" />
                                                    </div>
                                                {% else %}
                                                    <div class="image-container">
                                                        <img src="{{ MEDIA_URL }}images/society_logo_none.png" />
                                                    </div>
                                                {% endif %}
                                            </td>
                                            <td>
                                                {% if node_society.society.url %}
                                                    <a href="{{ node_society.society.url }}" target="_blank">
                                                {% endif %}
                                                <span>{{ node_society.society.name }} ({{ node_society.society.abbreviation }})</span>
                                                {% if node_society.society.url %}
                                                    <img src="{{ MEDIA_URL }}images/popup.png" />
                                                {% endif %}
                                                {% if node_society.society.url %}
                                                    </a>
                                                {% endif %}
                                                {% if node_society.is_machine_generated %}
                                                    <img src="{{ MEDIA_URL }}images/drive.png" alt="Machine-generated link" title="Machine-generated link" style="vertical-align:middle;" />
                                                {% endif %}
                                            </td>
                                        </tr>    
                                    {% endfor %}
                                </table>
                                {% else %}
                                    <p class="no-resources">No organizations are currently tagged "{{ tag.name }}"</p>
                                {% endif %}
                            </div>
                        </div>
                        
                        <!-- Related Tags -->
                        <div id="related-tab" data-printUrl='{% url print_resource tag.id "related_tags" %}'>
                            <div class="group">
                                {% if tag.related_tags.all %}
                                    {% for related_tag in tag.related_tags.all %}
                                        <p class="{% cycle 'item_odd' 'item_even' %}">
                                            {% ifequal ui "textui" %}
                                                <a href="javascript:Tags.selectTag({{ related_tag.id }});">
                                                    <span>{{ related_tag.name }}</span>
                                                </a>
                                            {% else %}
                                                <span>{{ related_tag.name }}</span>
                                            {% endifequal %}
                                        </p>
                                    {% endfor %}
                                {% else %}
                                    <p class="no-resources">No related tags are currently tagged "{{ tag.name }}"</p>
                                {% endif %}
                            </div>
                        </div>
                        
                        <div id="conference-tab" data-printUrl='{% url print_resource tag.id "conferences" %}'>
                            <!-- Conferences -->
                            <div class="group">
                                <ul>
                                {% if conferences|length %}
                                    {% for resource in conferences %}
                                    <li>
                                        {% if resource.url and resource.url_status != "bad" %}
                                            <a href="{{ resource.url }}" target="_blank">
                                        {% endif %}
                                        <p class="{% cycle 'item_odd' 'item_even' %}">
                                            <span>{{resource.name}}</span>
                                            {% if resource.url and resource.url_status != "bad" %}
                                                <img src="{{ MEDIA_URL }}images/popup.png" />
                                            {% endif %}
                                            {% if resource.is_machine_generated %}
                                                <img src="{{ MEDIA_URL }}images/drive.png" alt="Machine-generated link" title="Machine-generated link" style="vertical-align:middle;" />
                                            {% endif %}
                                        </p>
                                        {% if resource.url and resource.url_status != "bad" %}
                                            </a>
                                        {% endif %}
                                        <p class="{% cycle 'desc_odd' 'desc_even' %} auto-truncate-words {length:165, flyover:true, flyoverPosition:'top', flyoverCustomClass:'resource-description'}">{{resource.description}}</p>
                                        {% if resource.is_current_conference and resource.other_conferences|length %}
                                            <p class="more-conferences">
                                                <a href="#" id="show-other-conferences-{{ resource.id }}" class="show-other-conferences {id: {{ resource.id }}}">
                                                    <img src="{{ MEDIA_URL }}images/plusbox.png"/>
                                                    Show {{ resource.other_conferences|length }} more conference{{ resource.other_conferences|pluralize }} in this series...
                                                </a>
                                                <a href="#" id="hide-other-conferences-{{ resource.id }}" class="hide-other-conferences {id: {{ resource.id }}}">
                                                    <img src="{{ MEDIA_URL }}images/minusbox.png"/>
                                                    Hide other conferences in this series
                                                </a>
                                            </p>
                                            
                                            <div id="other-conferences-{{ resource.id }}" class="other-conferences">
                                                {% for other_conference in resource.other_conferences %}
                                                    {% if other_conference.url and other_conference.url_status != "bad" %}
                                                        <a href="{{ other_conference.url }}" target="_blank">
                                                    {% endif %}
                                                    <p class="{% cycle 'item_odd' 'item_even' %}">
                                                        <span>{{other_conference.name}}</span>
                                                        {% if other_conference.url and other_conference.url_status != "bad" %}
                                                            <img src="{{ MEDIA_URL }}images/popup.png" />
                                                        {% endif %}
                                                        {% if other_conference.is_machine_generated %}
                                                            <img src="{{ MEDIA_URL }}images/drive.png" alt="Machine-generated link" title="Machine-generated link" style="vertical-align:middle;" />
                                                        {% endif %}
                                                    </p>
                                                    {% if other_conference.url and other_conference.url_status != "bad" %}
                                                        </a>
                                                    {% endif %}
                                                    <p class="{% cycle 'desc_odd' 'desc_even' %} auto-truncate-words {length:165, flyover:true, flyoverPosition:'top', flyoverCustomClass:'resource-description'}">{{other_conference.description}}</p>
                                                {% endfor %}
                                            </div>
                                            
                                        {% endif %}
                                    </li>    
                                    {% endfor %}
                                {% else %}
                                    <p class="no-resources">No conferences are currently tagged "{{ tag.name }}"</p>
                                {% endif %}
                            </ul>
                            </div>
                        </div>
                        
                        <div id="periodical-tab" data-printUrl='{% url print_resource tag.id "periodicals" %}'>
                            <!-- Periodicals -->
                            <div class="group">
                                <ul>
                                {% if periodicals|length %}
                                    {% for resource in periodicals %}
                                    <li>
                                        <p class="{% cycle 'item_odd' 'item_even' %}">
                                            {% if resource.url and resource.url_status != "bad" %}
                                                <a href="{{ resource.url }}" target="_blank">
                                            {% endif %}
                                            <span>{{resource.name}}</span>
                                            {% if resource.url and resource.url_status != "bad" %}
                                                <img src="{{ MEDIA_URL }}images/popup.png" />
                                            {% endif %}
                                            {% if resource.url and resource.url_status != "bad" %}
                                                </a>
                                            {% endif %}
                                            
                                            {% if resource.is_machine_generated %}
                                                <img src="{{ MEDIA_URL }}images/drive.png" alt="Machine-generated link" title="Machine-generated link" style="vertical-align:middle;" />
                                            {% endif %}
                                        </p>
                                        <p class="{% cycle 'desc_odd' 'desc_even' %} auto-truncate-words {length:165, flyover:true, flyoverPosition:'top', flyoverCustomClass:'resource-description'}">{{resource.description}}</p>
                                    </li>
                                    {% endfor %}
                                {% else %}
                                    <p class="no-resources">No periodicals are currently tagged "{{ tag.name }}"</p>
                                {% endif %}
                            </ul>
                            </div>
                        </div>
                        
                        <div id="standard-tab" data-printUrl='{% url print_resource tag.id "standards" %}'>
                            <!-- Standards -->
                            <div class="group">
                                <ul>
                                {% if standards|length %}
                                    {% for resource in standards %}
                                    <li>
                                        <p class="{% cycle 'item_odd' 'item_even' %}">
                                        {% if resource.url and resource.url_status != "bad" %}
                                            <a href="{{ resource.url }}" target="_blank">
                                        {% endif %}
                                            <span>{{resource.name}}</span>
                                            {% if resource.url and resource.url_status != "bad" %}
                                                <img src="{{ MEDIA_URL }}images/popup.png" />
                                            {% endif %}
                                        {% if resource.url and resource.url_status != "bad" %}
                                            </a>
                                        {% endif %}
                                        {% if resource.is_machine_generated %}
                                                <img src="{{ MEDIA_URL }}images/drive.png" alt="Machine-generated link" title="Machine-generated link" style="vertical-align:middle;" />
                                        {% endif %}
                                        </p> 
                                        <p class="{% cycle 'desc_odd' 'desc_even' %} auto-truncate-words {length:165, flyover:true, flyoverPosition:'top', flyoverCustomClass:'resource-description'}">{{resource.description}}</p>
                                    </li>
                                    {% endfor %}
                                
                                {% else %}
                                    <p class="no-resources">No standards are currently tagged "{{ tag.name }}"</p>
                                {% endif %}
                            </ul>
                            </div>
                        </div>
                        
                        {% comment %}
                        #    <div>
                        #        <!-- Experts -->
                        #        <div class="group">
                        #            {% if experts|length %}
                        #                {% for resource in experts %}
                        #                    {% if resource.url %}
                        #                        <a href="{{ resource.url }}" target="_blank">
                        #                    {% endif %}
                        #                    <p class="{% cycle 'item_odd' 'item_even' %}">{{resource.name}}</p>
                        #                    {% if resource.url %}
                        #                        </a>
                        #                    {% endif %}
                        #                    <p class="{% cycle 'desc_odd' 'desc_even' %}">{{resource.description}}</p>
                        #                {% endfor %}
                        #            {% else %}
                        #                <p class="no-resources">(no experts)</p>
                        #            {% endif %}
                        #        </div>
                        #    </div>
                        {% endcomment %}

                        <div id="xplore-tab" data-printUrl='{% url print_resource tag.id "xplore" %}'>
                            <!-- Xplore -->
                            <div id="xplore-results-container" class="{ tagId: {{ tag.id }} }">
                                {# NOTE: This is replaced by ajax after page load. #}
                            </div>

                        </div>
                        
                        <script type="text/javascript">
                            $(function() {
                                var printDropDown = $('#printSelect').imageDropdown({'selectList': $("ul#printSelect_options")});
                                printDropDown.bind('change', function(){
                                    var type = printDropDown.val();
                                    if (type === "all"){
                                        printWin = window.open("{% url print_resource tag.id 'all' %}", "printWindow");
                                    } else if (type === "cur"){
                                        var printUrl = $('.nootabs-selected-tab[data-printUrl]').eq(0).attr('data-printUrl');
                                        printWin = window.open(printUrl, "printWindow");
                                    }
                                    printDropDown.close();
                                    printDropDown.reset();
                                })
                                
                                attachXploreResults('#xplore-results-container');
                            });
                        </script>
                    
                    </div>
    
    {% if is_ajax %}
                </div>
            </div>
        </div>
    {% endif %}

{% endblock %}

