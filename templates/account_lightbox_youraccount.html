{% load socialaccount %}

<a class="lightbox-close"></a>
<h2>Your Account</h2>

<div id="account-tabs" class="nootabs {useCookies:false, useHash:false}">
    <ul class="nootabs-menus">
        <li><a href="">Alerts</a></li>
        <li><a href="">Favorites</a></li>
        <li class="last-menu"><a href="">Connected Accounts</a></li>
    </ul>

    <!-- Alerts tab -->
    <div id="alerts-tab" class="nootabs-tab">
       {% if alerts %}
		<p class="first">You will be emailed an alert at {{ user.email }} when a new resource as been associated to any of these topics you are subscribed to.</p>
		<ul class="topicList">
			{% for alert in alerts %}
			<li><a href="javascript:Tags.selectTag({{ alert.node.id }});" onclick="_gaq.push(['_trackEvent', 'Tags', 'Click', '{{ alert.node.name}}']);" rel="nofollow">{{ alert.node.name }}</a> <span class="icon-cancel unsubscribe icomoon-icon" data-nodeid="{{ alert.node.id }}"></span></li>
			{% endfor %}
		</ul>
		{% else %}
		You are not subscribed to any alerts. Click the <span class="icon-alert icomoon-icon"></span> icon to subscribe to alerts.
		{% endif %}
    </div>
    
    <!-- Favorites tab -->
    <div id="favorites-tab" class="nootabs-tab">
		{% if favorite_topics or favorite_resources %}
		<p class="first">By clicking the <span class="icon-star-whole icomoon-icon"></span> next to a topic or resource, it will be listed here for easy access later.</p>
        <strong>IEEE Organizations</strong><br/>
        <ul class="topicList">
            {% for society in favorite_societies %}
            <li><a href="{{ society.url }}" rel="nofollow">{{ society.name }}</a> <span class="icon-cancel unfavorite-society icomoon-icon" data-nodeid="{{ society.id }}"></span>
            {% endfor %}
        </ul>
		<strong>Topics</strong><br/>
        <ul class="topicList">
			{% for topic in favorite_topics %}
			<li><a href="javascript:Tags.selectTag({{ topic.id }});" onclick="_gaq.push(['_trackEvent', 'Tags', 'Click', '{{ topic.name}}']);" rel="nofollow">{{ topic.name }}</a> <span class="icon-cancel unfavorite-topic icomoon-icon" data-nodeid="{{ topic.id }}"></span>
			{% endfor %}
		</ul>
        {% regroup favorite_resources by resource_type as favorite_resources %}
        {% for resource_type in favorite_resources %}
        <strong>{{ resource_type.grouper|title }}s</strong>
        <ul class="topicList">
            {% for resource in resource_type.list %}
            <li><a href="{{ resource.url }}" target="_blank" rel="nofollow">{{ resource.name }}<span class="popup newWinIcon"></span></a> <span class="icon-cancel unfavorite-resource icomoon-icon" data-nodeid="{{ resource.id }}"></span>
            {% endfor %}
        </ul>
        {% endfor %}
		{% else %}
		You have not favorited any topics or resources. Click the <span class="icon-star -wholeicomoon-icon"></span> icon to add a topic to your favorites.
		{% endif %}
    </div>

    <!-- Connected Accounts tab -->
    <div id="connectacct-tab" class="nootabs-tab">
        You can remove your connected social media accounts:
        {% get_social_accounts user as accounts %}
        {% if accounts %}
            <ul>
            {% for key, values in accounts.items %}
                <li>{{ key }} accounts:
                    <ul>
                    {% for account in values %}
                        <li>{{ account.user.username }}</li>
                    {% endfor %}
                    </ul>
                </li>
            {% endfor %}
            </ul>
        {% else %}
            There are no connected accounts (impossible situation)
        {% endif %}

        You can connect new social media accounts:
        <div>
            <a class="btn account" href="{% provider_login_url "google" process="connect" %}"><span class="icon-google icomoon-icon"></span>Sign In or Join with Google</a>
    {#	    <a class="btn account" href="{% provider_login_url "facebook" process="connect" %}"><span class="icon-facebook icomoon-icon"></span>Sign In or Join with Facebook</a>#}
            <a class="btn account" href="{% provider_login_url "linkedin_oauth2" process="connect" %}"><span class="icon-linkedin icomoon-icon"></span>Sign In or Join with LinkedIn</a>
        </div>

    </div>

</div>
<div class="clearfix"></div>

<script type="text/javascript">
    $(function() {
        var action;
        var nodeid;
        $('.unsubscribe').click(function(){
        	nodeid = $(this).data('nodeid');
        	$(this).parent().remove();
            $.post('/ajax/notification/request',
                {
                    email: '{{ user.email }}',
                    nodeid: nodeid,
                    action: 'disable'
                },
                function(){
                    return false;
                }
            );
        });
    });
    $(function() {
    	var action;
        var nodeid;
        $('.unfavorite-topic').click(function(){
            nodeid = $(this).data('nodeid');
            $(this).parent().remove();
            $.post('/ajax/favorite-topic/request',
                {
                    nodeid: nodeid,
                    action: 'disable'
                },
                function(){
                    return false;
                }
            );
        });
    });
    $(function() {
        var action;
        var nodeid;
        $('.unfavorite-resource').click(function(){
            nodeid = $(this).data('nodeid');
            $(this).parent().remove();
            $.post('/ajax/favorite-resource/request',
                {
                    nodeid: nodeid,
                    action: 'disable'
                },
                function(){
                    return false;
                }
            );
        });
    });
    $(function() {
        var action;
        var nodeid;
        $('.unfavorite-society').click(function(){
            nodeid = $(this).data('nodeid');
            $(this).parent().remove();
            $.post('/ajax/favorite-society/request',
                {
                    nodeid: nodeid,
                    action: 'disable'
                },
                function(){
                    return false;
                }
            );
        });
    });
</script>
