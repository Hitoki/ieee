{% load socialaccount %}
{% load url from future %}
<strong>Connected Accounts</strong><br/>
{% get_social_accounts user as accounts %}
{% if accounts %}
    <ul>
    {% for key, values in accounts.items %}
        {% for account in values %}
            <li class="accountField">
                {{ account.extra_data.email }}{{ account.extra_data.emailAddress }} ({{ key|title }} Account)
                {% if accounts|length > 1 or accounts.items.0.1|length > 1 or user.get_profile.role = "admin" or user.get_profile.role = "society_admin" or user.get_profile.role = "society_manager" %}
                    <a class="disconnect_account icon-cancel icomoon-icon" href="#" title="Disconnect account" data-account-id="{{ account.id }}"></a>
                {% endif %}
            </li>
        {% endfor %}
    {% endfor %}
    </ul>
<p>
    You can connect another social media account:
{% else %}
    You can connect new social media accounts:
{% endif %}
    <span class="signinBtns">
        <a class="btn account connect_account" target="_blank" href="{% provider_login_url "google" process="connect" %}"><span class="icon-google icomoon-icon"></span>Connect your Google Account</a>
    {#    <a class="btn account" target="_blank" href="{% provider_login_url "facebook" process="connect" %}"><span class="icon-facebook icomoon-icon"></span>Sign In or Join with Facebook</a>#}
        <a class="btn account connect_account" target="_blank" href="{% provider_login_url "linkedin_oauth2" process="connect" %}"><span class="icon-linkedin icomoon-icon"></span>Connect your LinkedIn account</a>
    </span>
</p>
<p>
    <strong>Delete TechNav Account</strong><br/>
    Your social accounts will be disconnected and you will be unsubscribed from all alerts. This cannot be undone.<br/>
    <a href="javascript:void()" onclick="$('#connectacct-tab').load('/account/delete_confirm/');">Delete my account</a>
</p>

<script type="text/javascript">
    function update_connections() {
        // note: this function is also used in "socialaccount/connections.html"
        $('#connectacct-tab').load('/ajax/connections');
    }

    $('.disconnect_account').click(function () {
        $('.qtip').qtip('hide');
        var account_id = $(this).data('account-id');
        //todo: add some "refreshing" icon
        $.post("{% url 'socialaccount_connections' %}", {'account': account_id}, function () {
            update_connections()
        });
    }).qtip();
</script>
